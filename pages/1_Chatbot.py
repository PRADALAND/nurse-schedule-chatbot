if st.button("ë¶„ì„ ìš”ì²­"):
    if not query.strip():
        st.warning("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.")
        st.stop()

    # ë‚ ì§œ ë²”ìœ„ í•´ì„
    start, end = get_date_range_from_keyword(query)
    df_slice = df[(df["date"] >= start) & (df["date"] <= end)]

    # ============================
    # ğŸ”¥ í•œêµ­ì–´ ê°•ì œ í”„ë¡¬í”„íŠ¸ ì˜ì—­
    # ============================
    prompt = f"""
    # ì ˆëŒ€ ê·œì¹™(ì´ ê·œì¹™ì€ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•œë‹¤)
    1) ëª¨ë“  ë‹µë³€ì€ 100% í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
    2) ì˜ì–´ ë¬¸ì¥, ì˜ì–´ ìš©ì–´, ì˜ì–´ ë²ˆì—­íˆ¬ëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
    3) ìì—°ìŠ¤ëŸ½ê³  ì „ë¬¸ì ì¸ ê°„í˜¸ ìŠ¤ì¼€ì¤„ ë¶„ì„ ì–¸ì–´ë¡œë§Œ ë‹µí•œë‹¤.
    4) ì œê³µëœ ìŠ¤ì¼€ì¤„ ë°ì´í„°ì— ê¸°ë°˜í•˜ì—¬ë§Œ ë‹µí•˜ê³ , ì—†ëŠ” ì •ë³´ëŠ” ì¶”ë¡ í•˜ì§€ ì•ŠëŠ”ë‹¤.

    # ì‚¬ìš©ì ì§ˆë¬¸
    {query}

    # ë¶„ì„ ëŒ€ìƒ ê¸°ê°„
    {start} ~ {end}

    # ìë™ ì‚°ì¶œëœ ê¸°ì´ˆ í†µê³„
    - ì „ì²´ ê·¼ë¬´ì¼ìˆ˜(OFF ì œì™¸): {(df_slice['shift_type']!='OFF').sum()}
    - ì•¼ê°„ ê·¼ë¬´ íšŸìˆ˜: {(df_slice['shift_type']=='NIGHT').sum()}
    - ë¶„ì„ëœ ì¼ì • row ìˆ˜: {len(df_slice)}

    ìœ„ ë‚´ìš©ì„ í† ëŒ€ë¡œ, ì§ˆë¬¸ ì˜ë„ì— ë§ëŠ” ê°„ê²°í•˜ê³  ì •í™•í•œ í•œêµ­ì–´ ë¶„ì„ ê²°ê³¼ë¥¼ ì‘ì„±í•˜ë¼.
    """

    # â–¶ï¸ ì‹¤ì œ AI í˜¸ì¶œ
    response = call_llm(prompt)

    st.write(response)

    # ë¡œê·¸ ì €ì¥
    log_analysis(query, response)
